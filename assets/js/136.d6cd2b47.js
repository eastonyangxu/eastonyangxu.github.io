(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{641:function(s,a,n){"use strict";n.r(a);var t=n(4),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("图片服务器基于 "),a("code",[s._v("nginx")]),s._v(" 镜像，"),a("code",[s._v("nginx")]),s._v(" 镜像的服务器是 "),a("code",[s._v("ubuntu")]),s._v(" 系统。")])]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("执行命令时需要注意是在"),a("code",[s._v("宿主机")]),s._v("还是"),a("code",[s._v("容器")]),s._v("中执行。")]),s._v(" "),a("p",[s._v("修改了配置需要重载 nginx ，命令："),a("code",[s._v("docker exec file_nginx nginx -s reload")])])]),s._v(" "),a("h2",{attrs:{id:"_1-启动-nginx-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动-nginx-容器"}},[s._v("#")]),s._v(" 1. 启动 nginx 容器")]),s._v(" "),a("p",[s._v("这一步主要是拷贝 nginx 容器里面的配置到宿主机中。然后宿主机目录挂载到容器中，这样只要修改本地配置就可以同步到容器中了。但是修改了配置一定要重载配置，不然不生效。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 nginx 镜像，并命名容器名为 nginx（--name 后面跟的是自定义容器名）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在宿主机上执行：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器中的 /etc/nginx 文件夹拷贝到宿主机的 /file_nginx/nginx，需要确保 /file_nginx 文件夹已经存在。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nginx:/etc/nginx /file_nginx/nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器中的静态文件目录拷贝到宿主机，确保 /file_nginx 文件夹已经存在。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nginx:/usr/share/nginx/html /file_nginx/html  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以不用拷贝，如果不拷贝，后面启动图片容器的时候可以不映射该目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑：/file_nginx/nginx/conf.d/default.conf  # 或者在conf.d目录下新建一个以 .conf 结尾的文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /home/file/images/ 这个目录需要在后面容器中新建。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意路径不要配置错了。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一种方式：")]),s._v("\n    location /images/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root /home/file/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        autoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二种方式：")]),s._v("\n    location /images/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" /home/file/images/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        autoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止nginx容器，并删除容器。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h2",{attrs:{id:"_2-启动图片服务器容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动图片服务器容器"}},[s._v("#")]),s._v(" 2. 启动图片服务器容器")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个nginx容器，并命名为 file_nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 22端口用来sftp上传图片，80端口用来访问图片。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地 nginx 配置目录(nginx)挂载到容器中，静态文件目录(html)也挂载到容器中。文件目录(file)可以挂载到宿主机。把图片传到本地文件目录以后，就可以在浏览器访问了。配置文件目录和静态文件目录是通过第一步拷贝到宿主机的。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" file_nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(":22 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /file_nginx/nginx:/etc/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/log/nginx:/var/log/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /file_nginx/html:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /home/file:/home/file nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_3-进入容器进行各种操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-进入容器进行各种操作"}},[s._v("#")]),s._v(" 3. 进入容器进行各种操作")]),s._v(" "),a("p",[s._v("如果配置了图片目录挂载，这一步可以不用操作。不然需要直接把图片传到容器中。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".进入容器：docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" file_nginx /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".更新apt-get：apt-get update  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不更新直接进行安装可能会报错")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".安装openssh-server：apt-get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" openssh-server\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".启动ssh服务：/etc/init.d/ssh start   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/init.d/ssh status 查看状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".创建用户file并创建用户目录：useradd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /home/file "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".设置file用户的密码：passwd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".输入密码：xxxx  需要两次输入\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".切换用户：su "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不切换用户，是使用root创建的，后面如果使用file用户上传文件，images文件会没有权限！")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".创建images文件夹：mkdir /home/file/images\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".退出容器：ctrl+p+q\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"_4-使用-sftp-上传一张图片-查看效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用-sftp-上传一张图片-查看效果"}},[s._v("#")]),s._v(" 4. 使用 sftp 上传一张图片，查看效果")]),s._v(" "),a("p",[s._v("如果执行了第三步，就可以通过第四步上传文件。如果没有执行第三步，可以直接忽略，直接把图片拷贝到宿主机 file 目录即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".登录sftp：sftp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(" file@127.0.0.1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".输入密码：xxxx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".上传文件：put /Downloads/test.png /home/file/images\n\n注意：如果images文件没有权限，需要进入到容器对文件镜像权限更改\n可以使用：ls "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" 文件用户权限\n更改用户权限在root账号下：chown file:users images\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"_5-访问图片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-访问图片"}},[s._v("#")]),s._v(" 5. 访问图片")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# test.png是你上传的图片文件名包括后缀\nhttp:127.0.0.1:10000/images/test.png\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_6-配置容器自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置容器自启动"}},[s._v("#")]),s._v(" 6. 配置容器自启动")]),s._v(" "),a("p",[s._v("ssh 服务器在关闭容器后，在启动需要手动启动，也可以设置"),a("RouterLink",{attrs:{to:"/pages/9a3b98/#启动-docker-的时候自动启动容器-restart"}},[s._v("开机自启动")])],1)])}),[],!1,null,null,null);a.default=e.exports}}]);